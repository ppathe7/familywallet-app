# FamilyWallet 家計簿アプリ 要件定義書

## 📋 概要

FamilyWalletは、夫婦・カップル・家族向けのスマート家計管理アプリです。支出入力の簡素化（レシートOCR、音声入力、位置情報連動）と資産形成管理（投資ポートフォリオ、目標設定、シミュレーション）を統合し、家族が協力して家計を管理し、長期的な資産形成を支援します。

## 🎯 要求

### 支出管理要求
- レシート撮影による自動支出記録
- 音声入力による支出記録
- 位置情報連動による店舗・カテゴリ自動設定
- 定期支出の自動記録
- カテゴリ別予算管理
- 支出の家族間共有

### 資産形成管理要求
- 投資ポートフォリオの統合管理
- リアルタイム資産価値表示
- 目標設定・進捗管理
- 資産形成シミュレーション
- 投資パフォーマンス分析

### 家族共有要求
- 家族アカウント連携
- リアルタイム同期
- 支出承認フロー
- プライバシー設定

## 📝 機能仕様

### 画面/コンポーネント構成

#### 1. ホーム画面
- **ダッシュボード**: 月次収支、資産総額、目標進捗の概要表示
- **クイック入力**: 支出記録のショートカット
- **最近の支出**: 直近の支出履歴（5件）
- **予算進捗**: カテゴリ別予算の進捗バー

#### 2. 支出記録画面
- **レシート撮影**: カメラ起動、ガイドライン表示
- **音声入力**: 音声録音ボタン、認識結果表示
- **手動入力**: 金額、カテゴリ、店舗名の入力フォーム
- **位置情報連動**: 現在地から店舗・カテゴリ提案

#### 3. 支出一覧画面
- **フィルター**: 日付、カテゴリ、金額範囲での絞り込み
- **ソート**: 日付、金額、カテゴリでの並び替え
- **検索**: 店舗名、メモでの検索
- **編集・削除**: 支出データの修正・削除

#### 4. ポートフォリオ画面
- **資産一覧**: 投資資産の一覧表示
- **資産配分円グラフ**: カテゴリ別資産配分
- **損益表示**: 各資産の損益額・損益率
- **価格更新**: リアルタイム価格取得

#### 5. 目標管理画面
- **目標一覧**: 設定済み目標の一覧
- **目標設定**: 新規目標の作成
- **進捗表示**: 目標達成率の可視化
- **シミュレーション**: 達成予測の表示

#### 6. レポート画面
- **月次レポート**: 収支、資産推移のグラフ
- **カテゴリ分析**: 支出カテゴリ別の分析
- **投資分析**: 投資パフォーマンスの分析
- **予算分析**: 予算達成率の分析

#### 7. 設定画面
- **家族設定**: 家族メンバーの管理
- **カテゴリ設定**: 支出カテゴリのカスタマイズ
- **予算設定**: 月次予算の設定
- **プライバシー設定**: 共有範囲の設定

### 振る舞い

#### 支出記録の振る舞い
1. **レシート撮影時**
   - カメラ起動 → ガイドライン表示 → 撮影 → OCR処理 → 結果確認 → 保存

2. **音声入力時**
   - 音声録音開始 → 最大10秒録音 → 音声認識 → 自然言語処理 → 結果確認 → 保存

3. **位置情報連動時**
   - 位置情報取得 → 店舗データベース検索 → カテゴリ提案 → ユーザー確認 → 自動設定

#### 資産管理の振る舞い
1. **価格更新時**
   - 定時実行（毎日18時） → 各資産の価格取得 → 損益計算 → データベース更新

2. **目標シミュレーション時**
   - 目標設定 → 現在の積立額入力 → 期待リターン設定 → シミュレーション実行 → 結果表示

#### 家族共有の振る舞い
1. **支出共有時**
   - 支出記録 → 家族メンバーに通知 → リアルタイム同期 → ダッシュボード更新

2. **予算相談時**
   - 予算変更提案 → 家族メンバーに通知 → 承認待ち → 承認/却下 → 予算更新

### 制約条件

#### 技術的制約
- **レシートOCR**: 主要チェーン店のレシートのみ対応（認識精度95%以上）
- **音声認識**: 日本語のみ対応、雑音環境では精度低下
- **位置情報**: GPS精度による店舗判定の誤差
- **リアルタイム同期**: ネットワーク接続が必要

#### ビジネス的制約
- **データ保持**: 支出データは3年間保持
- **プライバシー**: 個人情報は暗号化して保存
- **API制限**: 外部APIの利用制限に準拠
- **コスト**: 月次API利用料金の上限設定

## 📊 データ要件

### データベース設計

#### ユーザーテーブル
```sql
users (
  id: UUID (PK)
  email: VARCHAR(255) UNIQUE
  password_hash: VARCHAR(255)
  family_id: UUID (FK)
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
)
```

#### 支出テーブル
```sql
expenses (
  id: UUID (PK)
  user_id: UUID (FK)
  amount: DECIMAL(10,2)
  category_id: UUID (FK)
  description: TEXT
  store_name: VARCHAR(255)
  receipt_image_url: VARCHAR(500)
  location_data: JSONB
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
)
```

#### 投資ポートフォリオテーブル
```sql
portfolio_assets (
  id: UUID (PK)
  user_id: UUID (FK)
  symbol: VARCHAR(20)
  asset_type: VARCHAR(50)
  quantity: DECIMAL(15,8)
  purchase_price: DECIMAL(15,8)
  purchase_date: DATE
  current_price: DECIMAL(15,8)
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
)
```

#### 目標テーブル
```sql
goals (
  id: UUID (PK)
  user_id: UUID (FK)
  family_id: UUID (FK)
  goal_name: VARCHAR(255)
  target_amount: DECIMAL(15,2)
  current_amount: DECIMAL(15,2)
  deadline: DATE
  monthly_contribution: DECIMAL(10,2)
  created_at: TIMESTAMP
  updated_at: TIMESTAMP
)
```

### 外部API連携

#### 金融データAPI
- **株価データ**: Alpha Vantage API
- **為替レート**: 日本銀行API
- **暗号資産**: CoinGecko API

#### AI・OCR API
- **レシートOCR**: Google Vision API
- **音声認識**: OpenAI Whisper API
- **自然言語処理**: OpenAI GPT-4 API

## 🔄 インタラクション

### 外部システム連携
- **銀行API**: 口座振替の自動検知
- **メールAPI**: 請求書メールの自動解析
- **カレンダーAPI**: 定期支出のスケジュール管理

### 内部コンポーネント連携
- **認証サービス**: JWT認証、パスワードハッシュ化
- **暗号化サービス**: 機密データの暗号化・復号化
- **通知サービス**: プッシュ通知、メール通知
- **レポート生成サービス**: 月次レポートの自動生成

### データフロー
1. **支出記録**: フロントエンド → API → データベース → 家族メンバーに通知
2. **価格更新**: スケジューラー → 外部API → データベース → フロントエンドに通知
3. **レポート生成**: スケジューラー → データベース → レポート生成 → ユーザーに通知

## ❓ 未解決の質問

### 技術的質問
1. **レシートOCRの精度**: どの程度の認識精度を目標とするか？
2. **音声認識の対応言語**: 方言やアクセントへの対応範囲は？
3. **位置情報の精度**: GPS精度による店舗判定の誤差許容範囲は？

### ビジネス的質問
1. **収益化モデル**: フリーミアム vs サブスクリプションの選択
2. **データ保持期間**: 支出データの保持期間の妥当性
3. **プライバシー設定**: 家族間でのデータ共有範囲のデフォルト設定

### ユーザビリティ質問
1. **オフライン対応**: ネットワーク接続がない場合の機能制限範囲
2. **バックアップ**: データのバックアップ・復元機能の必要性
3. **マルチデバイス**: 複数デバイスでの同期タイミング

### 法的・コンプライアンス質問
1. **個人情報保護**: 金融データの取り扱いに関する法的要件
2. **データ移行**: 他サービスからのデータ移行機能の必要性
3. **利用規約**: 家族共有機能における責任分担の明確化

## 📱 技術スタック

### フロントエンド
- **フレームワーク**: React Native + TypeScript
- **状態管理**: Redux Toolkit + RTK Query
- **ナビゲーション**: React Navigation
- **UI ライブラリ**: React Native Elements

### バックエンド
- **ランタイム**: Kotlin + Spring Boot
- **アーキテクチャ**: DDD (ドメイン駆動設計) + ヘキサゴナルアーキテクチャ
- **データベース**: PostgreSQL + JPA/Hibernate
- **キャッシュ**: Redis
- **認証**: JWT + Spring Security

### クラウドインフラ
- **プラットフォーム**: AWS
- **コンテナ**: Docker + ECS Fargate
- **ストレージ**: S3
- **CDN**: CloudFront

### 外部API
- **OCR**: Google Vision API
- **音声認識**: OpenAI Whisper API
- **自然言語処理**: OpenAI GPT-4 API
- **金融データ**: Alpha Vantage API, CoinGecko API

## 🚀 開発フェーズ

### Phase 1: 基本機能（MVP）
- ユーザー認証・登録
- 基本的な支出記録（手動入力）
- カテゴリ管理
- 月次予算設定
- 基本的なレポート

### Phase 2: スマート機能
- レシートOCR
- 音声入力
- 位置情報連動
- 定期支出自動記録

### Phase 3: 資産管理
- 投資ポートフォリオ管理
- リアルタイム価格取得
- 目標設定・管理
- シミュレーション機能

### Phase 4: 家族共有
- 家族アカウント連携
- リアルタイム同期
- 支出承認フロー
- プライバシー設定

### Phase 5: 高度な分析
- 月次レポート自動生成
- 投資パフォーマンス分析
- 予算最適化提案
- 目標達成シミュレーション
